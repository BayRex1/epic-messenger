<!DOCTYPE html>
<html>
<head>
    <title>Epic - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif; 
            background: #0f1419;
            color: #e6e6e6;
            padding: 20px;
        }
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #00b894;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2.5em;
        }
        .login-section {
            background: #1a232c;
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid #2a3a4a;
        }
        .login-section input {
            padding: 14px 20px;
            margin: 15px;
            border: 1px solid #2a3a4a;
            border-radius: 12px;
            background: #2a3a4a;
            color: #e6e6e6;
            width: 250px;
            font-size: 16px;
            transition: all 0.3s;
        }
        .login-section input:focus {
            outline: none;
            border-color: #00b894;
            background: #3a4a5a;
        }
        .login-section button {
            padding: 14px 30px;
            background: #00b894;
            color: #0f1419;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }
        .login-section button:hover {
            background: #00d4aa;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 184, 148, 0.3);
        }
        .admin-panel {
            display: none;
            background: #1a232c;
            padding: 30px;
            border-radius: 20px;
            border: 1px solid #2a3a4a;
        }
        .users-list {
            margin-top: 30px;
        }
        .user-item {
            display: flex;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #2a3a4a;
            background: #2a3a4a;
            margin-bottom: 15px;
            border-radius: 16px;
            transition: all 0.3s;
        }
        .user-item:hover {
            background: #3a4a5a;
            transform: translateY(-2px);
        }
        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #3a4a5a;
            margin-right: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
            color: #8a9ba8;
            border: 2px solid #00b894;
            overflow: hidden;
        }
        .user-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        .user-info {
            flex: 1;
        }
        .user-info h3 {
            margin-bottom: 8px;
            font-size: 18px;
            display: flex;
            align-items: center;
        }
        .user-info p {
            color: #8a9ba8;
            font-size: 14px;
            margin: 4px 0;
        }
        .user-actions {
            display: flex;
            gap: 10px;
        }
        .user-actions button {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .verify-btn {
            background: #00b894;
            color: #0f1419;
        }
        .verify-btn:hover {
            background: #00d4aa;
        }
        .unverify-btn {
            background: #e17055;
            color: white;
        }
        .unverify-btn:hover {
            background: #ff7f67;
        }
        .developer-btn {
            background: #0088cc;
            color: white;
        }
        .developer-btn:hover {
            background: #0099e6;
        }
        .remove-dev-btn {
            background: #6c5ce7;
            color: white;
        }
        .remove-dev-btn:hover {
            background: #7d6ff7;
        }
        .verified-badge {
            color: #00b894;
            margin-left: 8px;
            font-size: 16px;
        }
        .developer-badge {
            color: #0088cc;
            margin-left: 8px;
            font-size: 16px;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: #2a3a4a;
            padding: 25px;
            border-radius: 16px;
            flex: 1;
            text-align: center;
            border: 1px solid #3a4a5a;
        }
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #00b894;
            margin-bottom: 8px;
        }
        .stat-label {
            color: #8a9ba8;
            font-size: 14px;
        }
        .status-online { color: #00b894; }
        .status-away { color: #fdcb6e; }
        .status-dnd { color: #e17055; }
        .status-offline { color: #636e72; }
        .search-admin {
            margin-bottom: 20px;
        }
        .search-admin input {
            width: 100%;
            padding: 12px 20px;
            border: 1px solid #2a3a4a;
            border-radius: 12px;
            background: #2a3a4a;
            color: #e6e6e6;
            font-size: 16px;
        }
        .search-admin input:focus {
            outline: none;
            border-color: #00b894;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <h1>‚öôÔ∏è –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å Epic Messenger</h1>
        
        <div id="loginSection" class="login-section">
            <h3>–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h3>
            <input type="password" id="adminPassword" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞">
            <button onclick="adminLogin()">–í–æ–π—Ç–∏</button>
            <p style="margin-top: 20px; color: #8a9ba8; font-size: 14px;">
                –ü–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: admin123
            </p>
        </div>
        
        <div id="adminPanel" class="admin-panel">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalUsers">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="verifiedUsers">0</div>
                    <div class="stat-label">–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="developerUsers">0</div>
                    <div class="stat-label">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="onlineUsers">0</div>
                    <div class="stat-label">–û–Ω–ª–∞–π–Ω —Å–µ–π—á–∞—Å</div>
                </div>
            </div>
            
            <div class="search-admin">
                <input type="text" id="adminSearch" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ email..." oninput="searchUsers()">
            </div>
            
            <h2 style="margin-bottom: 20px;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
            <div class="users-list" id="usersList">
                <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>
    </div>

    <script>
        let allUsers = [];
        
        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            
            fetch('/api/admin/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    document.getElementById('loginSection').style.display = 'none';
                    document.getElementById('adminPanel').style.display = 'block';
                    loadUsers();
                } else {
                    alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            });
        }

        function loadUsers() {
            fetch('/api/admin/users')
                .then(response => response.json())
                .then(users => {
                    allUsers = users;
                    updateUsersDisplay(users);
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
                    alert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');
                });
        }

        function searchUsers() {
            const searchTerm = document.getElementById('adminSearch').value.toLowerCase().trim();
            
            if (searchTerm === '') {
                updateUsersDisplay(allUsers);
                return;
            }
            
            const filteredUsers = allUsers.filter(user => 
                user.username.toLowerCase().includes(searchTerm) ||
                user.email.toLowerCase().includes(searchTerm)
            );
            
            updateUsersDisplay(filteredUsers);
        }

        function updateUsersDisplay(users) {
            document.getElementById('totalUsers').textContent = allUsers.length;
            document.getElementById('verifiedUsers').textContent = allUsers.filter(u => u.verified).length;
            document.getElementById('developerUsers').textContent = allUsers.filter(u => u.isDeveloper).length;
            document.getElementById('onlineUsers').textContent = allUsers.filter(u => u.status === 'online').length;
            
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = users.map(user => `
                <div class="user-item">
                    <div class="user-avatar">
                        ${user.avatar ? 
                            `<img src="${user.avatar}" alt="${user.username}" onerror="this.style.display='none'">` :
                            user.username.charAt(0).toUpperCase()
                        }
                    </div>
                    <div class="user-info">
                        <h3>${user.username} 
                            ${user.verified ? '<span class="verified-badge" title="–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç">‚úÖ</span>' : ''}
                            ${user.isDeveloper ? '<span class="developer-badge" title="–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ Epic">üë®‚Äçüíª</span>' : ''}
                        </h3>
                        <p>üìß ${user.email}</p>
                        <p>üÜî ${user.id}</p>
                        <p>üìÖ –°–æ–∑–¥–∞–Ω: ${new Date(user.createdAt).toLocaleDateString()}</p>
                        <p class="status-${user.status}">${getStatusEmoji(user.status)} ${user.status}</p>
                    </div>
                    <div class="user-actions">
                        ${user.verified ? 
                            `<button class="unverify-btn" onclick="toggleVerify('${user.id}', false)">‚ùå –°–Ω—è—Ç—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é</button>` :
                            `<button class="verify-btn" onclick="toggleVerify('${user.id}', true)">‚úÖ –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å</button>`
                        }
                        ${user.isDeveloper ? 
                            `<button class="remove-dev-btn" onclick="toggleDeveloper('${user.id}', false)">üö´ –£–±—Ä–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</button>` :
                            `<button class="developer-btn" onclick="toggleDeveloper('${user.id}', true)">üë®‚Äçüíª –°–¥–µ–ª–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º</button>`
                        }
                    </div>
                </div>
            `).join('');
        }

        function getStatusEmoji(status) {
            const emojiMap = {
                'online': 'üü¢',
                'away': 'üü°', 
                'dnd': 'üî¥',
                'offline': '‚ö´'
            };
            return emojiMap[status] || '‚ö´';
        }

        function toggleVerify(userId, verify) {
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ ${verify ? '–≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å' : '—Å–Ω—è—Ç—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é'} —ç—Ç–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞?`)) {
                return;
            }
            
            fetch('/api/admin/toggle-verify', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId, verified: verify })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert(result.message);
                    loadUsers(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + result.message);
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            });
        }

        function toggleDeveloper(userId, isDeveloper) {
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ ${isDeveloper ? '—Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º' : '—É–±—Ä–∞—Ç—å —Ä–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞'}?`)) {
                return;
            }
            
            fetch('/api/admin/toggle-developer', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId, isDeveloper })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert(result.message);
                    loadUsers(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + result.message);
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            });
        }

        // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
        document.getElementById('adminPassword').value = 'admin123';
        
        // –ü–æ–∏—Å–∫ –ø–æ Enter
        document.getElementById('adminSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchUsers();
            }
        });
    </script>
</body>
</html>
