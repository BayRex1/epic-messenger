[file name]: mobile.html
[file content begin]
<!DOCTYPE html>
<html>
<head>
    <title>Epic Messenger</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        :root {
            --bg-primary: #0f1419;
            --bg-secondary: #1a232c;
            --bg-tertiary: #2a3a4a;
            --border-color: #2a3a4a;
            --text-primary: #e6e6e6;
            --text-secondary: #8a9ba8;
            --accent-color: #0088cc;
            --accent-hover: #0099e6;
            --success-color: #00b894;
            --error-color: #e17055;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            height: -webkit-fill-available;
            overflow: hidden;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            height: -webkit-fill-available;
        }
        
        /* Header */
        .header {
            background: var(--bg-secondary);
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            min-height: 60px;
        }
        
        .header-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .icon-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .icon-btn:active {
            background: var(--bg-tertiary);
        }
        
        /* Navigation */
        .nav-tabs {
            display: flex;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            border-bottom: 3px solid transparent;
            font-size: 14px;
            font-weight: 600;
        }
        
        .nav-tab.active {
            border-bottom-color: var(--accent-color);
            color: var(--accent-color);
        }
        
        /* Content Areas */
        .content-area {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }
        
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .page.hidden {
            display: none;
        }
        
        /* Chats List */
        .chats-list {
            padding: 10px;
        }
        
        .chat-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 8px;
            background: var(--bg-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .chat-item:active {
            background: var(--bg-tertiary);
            transform: scale(0.98);
        }
        
        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 18px;
            margin-right: 15px;
            overflow: hidden;
        }
        
        .chat-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .chat-info {
            flex: 1;
        }
        
        .chat-name {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .chat-last-message {
            color: var(--text-secondary);
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Chat View */
        .chat-header {
            background: var(--bg-secondary);
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 24px;
            margin-right: 15px;
            padding: 5px;
        }
        
        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 80px;
        }
        
        .message {
            max-width: 85%;
            margin: 8px 0;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
            animation: messageAppear 0.3s ease;
        }
        
        @keyframes messageAppear {
            from { 
                opacity: 0; 
                transform: translateY(10px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        
        .message.incoming {
            background: var(--bg-secondary);
            align-self: flex-start;
            border-bottom-left-radius: 6px;
        }
        
        .message.outgoing {
            background: var(--accent-color);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 6px;
            margin-left: auto;
        }
        
        .message-sender {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .message-text {
            font-size: 16px;
            line-height: 1.4;
        }
        
        .message-time {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 4px;
            text-align: right;
        }
        
        /* File messages */
        .file-message {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            padding: 12px;
            border-radius: 12px;
            margin-top: 8px;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .file-icon {
            font-size: 24px;
            margin-right: 12px;
        }
        
        .file-details {
            flex: 1;
        }
        
        .file-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .file-size {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .file-preview {
            margin-top: 8px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .file-preview img, .file-preview video {
            max-width: 100%;
            border-radius: 8px;
        }
        
        .file-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        
        .file-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            flex: 1;
            text-align: center;
        }
        
        .file-btn:active {
            background: var(--accent-hover);
        }
        
        /* Message Input */
        .message-input-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 10px 15px;
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
        }
        
        .message-input-wrapper {
            display: flex;
            align-items: center;
            background: var(--bg-tertiary);
            border-radius: 25px;
            padding: 8px 15px;
        }
        
        .attach-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            margin-right: 10px;
            padding: 5px;
        }
        
        .message-input {
            flex: 1;
            border: none;
            background: transparent;
            color: var(--text-primary);
            font-size: 16px;
            outline: none;
            padding: 8px 0;
        }
        
        .message-input::placeholder {
            color: var(--text-secondary);
        }
        
        .send-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-left: 10px;
            font-size: 18px;
            cursor: pointer;
        }
        
        .send-btn:active {
            background: var(--accent-hover);
            transform: scale(0.95);
        }
        
        /* Search */
        .search-container {
            padding: 15px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }
        
        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 25px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 16px;
            outline: none;
        }
        
        .search-input::placeholder {
            color: var(--text-secondary);
        }
        
        /* Posts */
        .posts-list {
            padding: 10px;
        }
        
        .post {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
        }
        
        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 12px;
            overflow: hidden;
        }
        
        .post-user-info {
            flex: 1;
        }
        
        .post-user-name {
            font-weight: 600;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .post-time {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .post-content {
            margin-bottom: 12px;
        }
        
        .post-text {
            font-size: 15px;
            line-height: 1.4;
            margin-bottom: 8px;
        }
        
        .post-image {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 8px;
        }
        
        .post-actions {
            display: flex;
            gap: 20px;
            border-top: 1px solid var(--border-color);
            padding-top: 12px;
        }
        
        .post-action {
            display: flex;
            align-items: center;
            gap: 6px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
        }
        
        .post-action.liked {
            color: var(--error-color);
        }
        
        /* Profile */
        .profile-section {
            padding: 20px;
        }
        
        .profile-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
            margin: 0 auto 15px;
            overflow: hidden;
        }
        
        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .profile-username {
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        
        .profile-status {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .profile-info {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .profile-item {
            margin-bottom: 12px;
        }
        
        .profile-item:last-child {
            margin-bottom: 0;
        }
        
        .profile-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        /* Badges */
        .verified-badge, .developer-badge {
            display: inline-flex;
            align-items: center;
        }
        
        .verified-badge svg, .developer-badge svg {
            width: 16px;
            height: 16px;
        }
        
        .gold-path {
            fill: #FFD700;
            stroke: #FFB700;
            stroke-width: 1;
        }
        
        .blue-path {
            fill: #0088cc;
            stroke: #00a8ff;
            stroke-width: 1;
        }
        
        /* Gifts */
        .gifts-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .gift-item {
            text-align: center;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            cursor: pointer;
        }
        
        .gift-preview {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 5px;
            overflow: hidden;
        }
        
        .gift-preview img, .gift-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .gift-name {
            font-size: 12px;
            font-weight: 600;
        }
        
        .gift-price {
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        /* Admin */
        .admin-section {
            padding: 20px;
        }
        
        .admin-user-item {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .admin-user-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .admin-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 12px;
            overflow: hidden;
        }
        
        .admin-user-info {
            flex: 1;
        }
        
        .admin-user-name {
            font-weight: 600;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .admin-user-email {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .admin-actions {
            display: flex;
            gap: 8px;
        }
        
        .admin-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .admin-btn.active {
            background: var(--accent-color);
            color: white;
        }
        
        .admin-btn.delete {
            background: var(--error-color);
            color: white;
        }
        
        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 24px;
            cursor: pointer;
        }
        
        /* Keyboard fixes */
        .keyboard-open .chat-messages {
            padding-bottom: 120px;
        }
        
        .keyboard-open .message-input-container {
            position: relative;
        }
        
        /* Safe area insets for notch phones */
        @supports (padding: max(0px)) {
            .header, .message-input-container {
                padding-left: max(15px, env(safe-area-inset-left));
                padding-right: max(15px, env(safe-area-inset-right));
            }
            
            .message-input-container {
                padding-bottom: max(10px, env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Main View -->
        <div id="mainView" class="page">
            <div class="header">
                <div class="header-title">Epic Messenger</div>
                <div class="header-actions">
                    <button class="icon-btn" onclick="showProfile()">üë§</button>
                    <button class="icon-btn" onclick="showSearch()">üîç</button>
                </div>
            </div>
            
            <div class="nav-tabs">
                <div class="nav-tab active" onclick="showTab('chats')">üí¨ –ß–∞—Ç—ã</div>
                <div class="nav-tab" onclick="showTab('posts')">üìù –ü–æ—Å—Ç—ã</div>
            </div>
            
            <div class="search-container">
                <input type="text" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π..." id="searchInput" oninput="searchUsers()">
            </div>
            
            <div class="content-area">
                <!-- Chats Section -->
                <div id="chatsSection" class="chats-list">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤...</div>
                </div>
                
                <!-- Posts Section -->
                <div id="postsSection" class="posts-list" style="display: none;">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤...</div>
                </div>
            </div>
        </div>
        
        <!-- Chat View -->
        <div id="chatView" class="page hidden">
            <div class="chat-header">
                <button class="back-btn" onclick="closeChat()">‚Üê</button>
                <div class="chat-info">
                    <div class="chat-name" id="chatUserName">
                        <span id="chatUserNameText">User</span>
                    </div>
                    <div class="chat-last-message" id="chatUserStatus">Online</div>
                </div>
            </div>
            
            <div class="content-area">
                <div id="chatMessages" class="chat-messages">
                    <div class="empty-state">
                        <div class="empty-state-icon">üí¨</div>
                        <div>–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ</div>
                    </div>
                </div>
            </div>
            
            <div class="message-input-container">
                <div class="message-input-wrapper">
                    <button class="attach-btn" onclick="openFilePicker()">üìé</button>
                    <input type="text" class="message-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." id="messageInput">
                    <button class="send-btn" onclick="sendMessage()">‚û§</button>
                </div>
            </div>
            
            <input type="file" id="fileInput" style="display: none;" accept="*/*">
        </div>
        
        <!-- Profile View -->
        <div id="profileView" class="page hidden">
            <div class="header">
                <button class="back-btn" onclick="closeProfile()">‚Üê</button>
                <div class="header-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
                <div class="header-actions">
                    <button class="icon-btn" onclick="showSettings()">‚öôÔ∏è</button>
                </div>
            </div>
            
            <div class="content-area">
                <div class="profile-section">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profileAvatar">
                            <span id="profileAvatarText">U</span>
                        </div>
                        <div class="profile-name" id="profileName">
                            <span id="profileNameText">User</span>
                        </div>
                        <div class="profile-username" id="profileUsername">@username</div>
                        <div class="profile-status" id="profileStatus">üü¢ Online</div>
                    </div>
                    
                    <div class="profile-info">
                        <div class="profile-item">
                            <div class="profile-label">–û–ø–∏—Å–∞–Ω–∏–µ</div>
                            <div id="profileDescription">–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è</div>
                        </div>
                        <div class="profile-item">
                            <div class="profile-label">–°—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞</div>
                            <div id="profileAccountStatus">–û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                        </div>
                    </div>
                    
                    <!-- –ü–æ–¥–∞—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                    <div class="profile-info">
                        <div class="profile-label">üéÅ –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏</div>
                        <div id="userGifts" class="gifts-grid">
                            <div class="empty-state" style="padding: 20px; grid-column: 1 / -1;">
                                <div>üéÅ</div>
                                <div style="font-size: 12px;">–ù–µ—Ç –ø–æ–¥–∞—Ä–∫–æ–≤</div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="chat-item" style="width: 100%; justify-content: center; background: var(--accent-color); color: white; margin-top: 15px;" onclick="mobileLogout()">
                        üö™ –í—ã–π—Ç–∏
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Settings View -->
        <div id="settingsView" class="page hidden">
            <div class="header">
                <button class="back-btn" onclick="closeSettings()">‚Üê</button>
                <div class="header-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            </div>
            
            <div class="content-area">
                <div class="profile-section">
                    <div class="profile-info">
                        <div class="profile-item" onclick="showEditProfile()" style="cursor: pointer;">
                            <div class="profile-label">üë§ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</div>
                            <div>–ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è, –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –∞–≤–∞—Ç–∞—Ä</div>
                        </div>
                        
                        <div class="profile-item" onclick="showShop()" style="cursor: pointer;">
                            <div class="profile-label">üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤</div>
                            <div>–ö—É–ø–∏—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥–∞—Ä–∫–∏</div>
                        </div>
                        
                        <div id="adminMenuItem" class="profile-item" onclick="showAdminPanel()" style="cursor: pointer; display: none;">
                            <div class="profile-label">üîê –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</div>
                            <div>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Admin View -->
        <div id="adminView" class="page hidden">
            <div class="header">
                <button class="back-btn" onclick="closeAdmin()">‚Üê</button>
                <div class="header-title">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</div>
            </div>
            
            <div class="content-area">
                <div class="admin-section">
                    <input type="text" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π..." id="adminSearch" oninput="searchAdminUsers()" style="margin-bottom: 15px;">
                    <div id="adminUsersList">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Shop View -->
        <div id="shopView" class="page hidden">
            <div class="header">
                <button class="back-btn" onclick="closeShop()">‚Üê</button>
                <div class="header-title">–ú–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤</div>
            </div>
            
            <div class="content-area">
                <div class="profile-section">
                    <div id="giftsList">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let socket = null;
        let currentUser = null;
        let currentChat = null;
        let allUsers = [];
        let gifts = [];
        let currentTab = 'chats';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            initializeApp();
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º —Ç–∞–ø–µ
            document.addEventListener('dblclick', function(e) {
                e.preventDefault();
            }, { passive: false });
        });
        
        async function initializeApp() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            currentUser = JSON.parse(localStorage.getItem('user'));
            if (!currentUser) {
                window.location.href = '/login.html';
                return;
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º socket.io
            socket = io();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            setupSocketEvents();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–æ–¥–∞—Ä–∫–∏
            await loadUsers();
            await loadGifts();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
            updateProfile();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–≤–æ–¥–∞
            setupInputHandlers();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å—Ç—ã
            loadPosts();
        }
        
        function setupSocketEvents() {
            socket.on('connect', function() {
                console.log('Connected to server');
                socket.emit('user_join', {
                    userId: currentUser.id,
                    username: currentUser.username,
                    displayName: currentUser.displayName
                });
            });
            
            socket.on('new_message', function(message) {
                if (currentChat && (message.userId === currentChat.id || message.toUserId === currentChat.id)) {
                    addMessageToChat(message, message.userId === currentUser.id);
                }
            });
            
            socket.on('chat_history_loaded', function(data) {
                if (currentChat && currentChat.id === data.targetId) {
                    displayMessages(data.messages);
                }
            });
            
            socket.on('user_online', function(user) {
                updateUserStatus(user.userId, 'online');
            });
            
            socket.on('user_offline', function(user) {
                updateUserStatus(user.userId, 'offline');
            });
            
            socket.on('user_verified', function(data) {
                if (currentUser.id === data.userId) {
                    currentUser.verified = data.verified;
                    localStorage.setItem('user', JSON.stringify(currentUser));
                    updateProfile();
                }
            });
            
            socket.on('user_developer_updated', function(data) {
                if (currentUser.id === data.userId) {
                    currentUser.isDeveloper = data.isDeveloper;
                    localStorage.setItem('user', JSON.stringify(currentUser));
                    updateProfile();
                }
            });
        }
        
        function setupInputHandlers() {
            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ Enter
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
            window.addEventListener('resize', function() {
                if (window.visualViewport) {
                    const keyboardHeight = window.innerHeight - window.visualViewport.height;
                    if (keyboardHeight > 100) {
                        document.body.classList.add('keyboard-open');
                        scrollToBottom();
                    } else {
                        document.body.classList.remove('keyboard-open');
                    }
                }
            });
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            document.getElementById('messageInput').addEventListener('focus', function() {
                setTimeout(scrollToBottom, 300);
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
            document.getElementById('fileInput').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    sendFile(e.target.files[0]);
                }
            });
        }
        
        async function loadUsers() {
            try {
                const response = await fetch(`/api/users?currentUserId=${currentUser.id}`);
                allUsers = await response.json();
                displayChatsList();
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('chatsList').innerHTML = '<div class="empty-state">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }
        
        async function loadGifts() {
            try {
                const response = await fetch('/api/gifts');
                gifts = await response.json();
            } catch (error) {
                console.error('Error loading gifts:', error);
            }
        }
        
        function displayChatsList() {
            const container = document.getElementById('chatsSection');
            
            if (allUsers.length === 0) {
                container.innerHTML = '<div class="empty-state">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';
                return;
            }
            
            container.innerHTML = allUsers.map(user => `
                <div class="chat-item" onclick="openChat('${user.id}')">
                    <div class="chat-avatar">
                        ${user.avatar ? 
                            `<img src="${user.avatar}" alt="${user.displayName}">` :
                            user.displayName.charAt(0).toUpperCase()
                        }
                    </div>
                    <div class="chat-info">
                        <div class="chat-name">
                            ${user.displayName}
                            ${user.verified ? getVerifiedBadge() : ''}
                            ${user.isDeveloper ? getDeveloperBadge() : ''}
                        </div>
                        <div class="chat-last-message">@${user.username} ‚Ä¢ ${getStatusText(user.status)}</div>
                    </div>
                </div>
            `).join('');
        }
        
        function getStatusText(status) {
            const statusMap = {
                'online': 'üü¢ Online',
                'away': 'üü° Away', 
                'dnd': 'üî¥ DND',
                'offline': '‚ö´ Offline'
            };
            return statusMap[status] || status;
        }
        
        function getVerifiedBadge() {
            return `
            <span class="verified-badge" title="–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç">
                <svg width="16" height="16" viewBox="0 0 16 16">
                    <circle cx="8" cy="8" r="7" fill="#FFD700" opacity="0.4"/>
                    <path class="gold-path" d="M4 8 L7 11 L12 5" fill="none"/>
                </svg>
            </span>
            `;
        }
        
        function getDeveloperBadge() {
            return `
            <span class="developer-badge" title="–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ Epic">
                <svg width="16" height="16" viewBox="0 0 16 16">
                    <circle cx="8" cy="8" r="7" fill="#0088cc" opacity="0.4"/>
                    <path class="blue-path" d="M4 8 L7 11 L12 5" fill="none"/>
                </svg>
            </span>
            `;
        }
        
        function openChat(userId) {
            currentChat = allUsers.find(u => u.id === userId);
            if (!currentChat) return;
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∏–¥ —á–∞—Ç–∞
            document.getElementById('mainView').classList.add('hidden');
            document.getElementById('chatView').classList.remove('hidden');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞
            document.getElementById('chatUserNameText').textContent = currentChat.displayName;
            document.getElementById('chatUserName').innerHTML = `
                ${currentChat.displayName}
                ${currentChat.verified ? getVerifiedBadge() : ''}
                ${currentChat.isDeveloper ? getDeveloperBadge() : ''}
            `;
            document.getElementById('chatUserStatus').textContent = getStatusText(currentChat.status);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞
            loadChatHistory();
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            setTimeout(() => {
                document.getElementById('messageInput').focus();
            }, 500);
        }
        
        function closeChat() {
            document.getElementById('chatView').classList.add('hidden');
            document.getElementById('mainView').classList.remove('hidden');
            currentChat = null;
        }
        
        function loadChatHistory() {
            if (!currentChat) return;
            
            const container = document.getElementById('chatMessages');
            container.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...</div>';
            
            socket.emit('load_chat_history', {
                userId: currentUser.id,
                targetId: currentChat.id
            });
        }
        
        function displayMessages(messages) {
            const container = document.getElementById('chatMessages');
            
            if (!messages || messages.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üí¨</div>
                        <div>–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = messages.map(msg => {
                const isOutgoing = msg.userId === currentUser.id;
                const sender = isOutgoing ? currentUser : currentChat;
                
                return `
                    <div class="message ${isOutgoing ? 'outgoing' : 'incoming'}">
                        ${!isOutgoing ? `
                            <div class="message-sender">
                                ${sender.displayName}
                                ${sender.verified ? getVerifiedBadge() : ''}
                                ${sender.isDeveloper ? getDeveloperBadge() : ''}
                            </div>
                        ` : ''}
                        
                        ${msg.type === 'file' ? renderFileMessage(msg) : `
                            <div class="message-text">${msg.text}</div>
                        `}
                        
                        <div class="message-time">${formatTime(msg.timestamp)}</div>
                    </div>
                `;
            }).join('');
            
            scrollToBottom();
        }
        
        function renderFileMessage(msg) {
            const file = msg.file;
            const isImage = file.type.startsWith('image/');
            const isVideo = file.type.startsWith('video/');
            
            return `
                <div class="file-message">
                    <div class="file-info">
                        <div class="file-icon">${getFileIcon(file.type)}</div>
                        <div class="file-details">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${formatFileSize(file.size)}</div>
                        </div>
                    </div>
                    
                    ${isImage ? `
                        <div class="file-preview">
                            <img src="${file.url}" alt="${file.name}">
                        </div>
                    ` : ''}
                    
                    ${isVideo ? `
                        <div class="file-preview">
                            <video controls>
                                <source src="${file.url}" type="${file.type}">
                            </video>
                        </div>
                    ` : ''}
                    
                    <div class="file-actions">
                        <button class="file-btn" onclick="downloadFile('${file.url}', '${file.name}')">üì• –°–∫–∞—á–∞—Ç—å</button>
                        ${isImage ? `<button class="file-btn" onclick="viewImage('${file.url}')">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>` : ''}
                    </div>
                </div>
            `;
        }
        
        function getFileIcon(type) {
            if (type.startsWith('image/')) return 'üñºÔ∏è';
            if (type.startsWith('video/')) return 'üé¨';
            if (type.startsWith('audio/')) return 'üéµ';
            if (type.includes('pdf')) return 'üìï';
            if (type.includes('word')) return 'üìÑ';
            if (type.includes('excel')) return 'üìä';
            if (type.includes('zip')) return 'üì¶';
            return 'üìé';
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function downloadFile(url, filename) {
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
        }
        
        function viewImage(url) {
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            window.open(url, '_blank');
        }
        
        function addMessageToChat(message, isOutgoing) {
            const container = document.getElementById('chatMessages');
            
            // –£–±–∏—Ä–∞–µ–º –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å
            if (container.querySelector('.empty-state')) {
                container.innerHTML = '';
            }
            
            const sender = isOutgoing ? currentUser : currentChat;
            
            const messageElement = document.createElement('div');
            messageElement.className = `message ${isOutgoing ? 'outgoing' : 'incoming'}`;
            messageElement.innerHTML = `
                ${!isOutgoing ? `
                    <div class="message-sender">
                        ${sender.displayName}
                        ${sender.verified ? getVerifiedBadge() : ''}
                        ${sender.isDeveloper ? getDeveloperBadge() : ''}
                    </div>
                ` : ''}
                
                ${message.type === 'file' ? renderFileMessage(message) : `
                    <div class="message-text">${message.text}</div>
                `}
                
                <div class="message-time">${formatTime(message.timestamp)}</div>
            `;
            
            container.appendChild(messageElement);
            scrollToBottom();
        }
        
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || !currentChat) return;
            
            const message = {
                userId: currentUser.id,
                toUserId: currentChat.id,
                text: text,
                timestamp: new Date().toISOString(),
                type: 'text'
            };
            
            socket.emit('send_message', message);
            addMessageToChat(message, true);
            
            input.value = '';
            input.focus();
        }
        
        function openFilePicker() {
            document.getElementById('fileInput').click();
        }
        
        async function sendFile(file) {
            if (!file || !currentChat) return;
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            // –î–ª—è –¥–µ–º–æ —Å–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç URL
            const fileUrl = URL.createObjectURL(file);
            
            const message = {
                userId: currentUser.id,
                toUserId: currentChat.id,
                type: 'file',
                file: {
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    url: fileUrl
                },
                timestamp: new Date().toISOString()
            };
            
            socket.emit('send_message', message);
            addMessageToChat(message, true);
            
            // –û—á–∏—â–∞–µ–º input
            document.getElementById('fileInput').value = '';
        }
        
        function scrollToBottom() {
            const container = document.getElementById('chatMessages');
            if (container) {
                container.scrollTop = container.scrollHeight;
            }
        }
        
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('ru-RU', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }
        
        function showTab(tabName) {
            if (currentTab === tabName) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–±—ã
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                if (tab.textContent.includes(tabName === 'chats' ? 'üí¨' : 'üìù')) {
                    tab.classList.add('active');
                }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
            document.getElementById('chatsSection').style.display = tabName === 'chats' ? 'block' : 'none';
            document.getElementById('postsSection').style.display = tabName === 'posts' ? 'block' : 'none';
            
            currentTab = tabName;
        }
        
        function loadPosts() {
            const container = document.getElementById('postsSection');
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
            const posts = [
                {
                    id: 1,
                    user: {
                        displayName: '–ê–ª–µ–∫—Å–µ–π –ò–≤–∞–Ω–æ–≤',
                        username: 'alexey',
                        avatar: null,
                        verified: true,
                        isDeveloper: false
                    },
                    content: '–ü—Ä–∏–≤–µ—Ç –≤—Å–µ–º! –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –ª–µ–Ω—Ç—ã –≤ –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏.',
                    image: null,
                    timestamp: new Date(Date.now() - 3600000).toISOString(),
                    likes: 5,
                    comments: 2,
                    liked: false
                },
                {
                    id: 2,
                    user: {
                        displayName: '–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞',
                        username: 'maria',
                        avatar: null,
                        verified: false,
                        isDeveloper: true
                    },
                    content: '–¢–æ–ª—å–∫–æ —á—Ç–æ –¥–æ–±–∞–≤–∏–ª–∞ –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–æ–≤ –≤ —á–∞—Ç! üéâ',
                    image: null,
                    timestamp: new Date(Date.now() - 7200000).toISOString(),
                    likes: 12,
                    comments: 3,
                    liked: true
                }
            ];
            
            container.innerHTML = posts.map(post => `
                <div class="post">
                    <div class="post-header">
                        <div class="post-avatar">
                            ${post.user.avatar ? 
                                `<img src="${post.user.avatar}" alt="${post.user.displayName}">` :
                                post.user.displayName.charAt(0).toUpperCase()
                            }
                        </div>
                        <div class="post-user-info">
                            <div class="post-user-name">
                                ${post.user.displayName}
                                ${post.user.verified ? getVerifiedBadge() : ''}
                                ${post.user.isDeveloper ? getDeveloperBadge() : ''}
                            </div>
                            <div class="post-time">${formatPostTime(post.timestamp)}</div>
                        </div>
                    </div>
                    <div class="post-content">
                        <div class="post-text">${post.content}</div>
                        ${post.image ? `<img src="${post.image}" class="post-image" alt="Post image">` : ''}
                    </div>
                    <div class="post-actions">
                        <button class="post-action ${post.liked ? 'liked' : ''}" onclick="toggleLike(${post.id})">
                            ‚ù§Ô∏è ${post.likes}
                        </button>
                        <button class="post-action" onclick="showComments(${post.id})">
                            üí¨ ${post.comments}
                        </button>
                        <button class="post-action" onclick="sharePost(${post.id})">
                            üîÑ
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function formatPostTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
            if (diffMins < 60) return `${diffMins} –º–∏–Ω –Ω–∞–∑–∞–¥`;
            if (diffHours < 24) return `${diffHours} —á –Ω–∞–∑–∞–¥`;
            if (diffDays < 7) return `${diffDays} –¥–Ω –Ω–∞–∑–∞–¥`;
            return date.toLocaleDateString('ru-RU');
        }
        
        function toggleLike(postId) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
            console.log('Toggle like for post:', postId);
        }
        
        function showComments(postId) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø–æ–∫–∞–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
            console.log('Show comments for post:', postId);
        }
        
        function sharePost(postId) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —à–∞—Ä–∏–Ω–≥–∞
            console.log('Share post:', postId);
        }
        
        function showProfile() {
            document.getElementById('mainView').classList.add('hidden');
            document.getElementById('profileView').classList.remove('hidden');
        }
        
        function closeProfile() {
            document.getElementById('profileView').classList.add('hidden');
            document.getElementById('mainView').classList.remove('hidden');
        }
        
        function showSettings() {
            document.getElementById('profileView').classList.add('hidden');
            document.getElementById('settingsView').classList.remove('hidden');
        }
        
        function closeSettings() {
            document.getElementById('settingsView').classList.add('hidden');
            document.getElementById('profileView').classList.remove('hidden');
        }
        
        function showAdminPanel() {
            document.getElementById('settingsView').classList.add('hidden');
            document.getElementById('adminView').classList.remove('hidden');
            loadAdminUsers();
        }
        
        function closeAdmin() {
            document.getElementById('adminView').classList.add('hidden');
            document.getElementById('settingsView').classList.remove('hidden');
        }
        
        function showShop() {
            document.getElementById('settingsView').classList.add('hidden');
            document.getElementById('shopView').classList.remove('hidden');
            displayGiftsShop();
        }
        
        function closeShop() {
            document.getElementById('shopView').classList.add('hidden');
            document.getElementById('settingsView').classList.remove('hidden');
        }
        
        function updateProfile() {
            if (!currentUser) return;
            
            document.getElementById('profileNameText').textContent = currentUser.displayName;
            document.getElementById('profileName').innerHTML = `
                ${currentUser.displayName}
                ${currentUser.verified ? getVerifiedBadge() : ''}
                ${currentUser.isDeveloper ? getDeveloperBadge() : ''}
            `;
            document.getElementById('profileUsername').textContent = `@${currentUser.username}`;
            document.getElementById('profileAvatarText').textContent = currentUser.displayName.charAt(0).toUpperCase();
            document.getElementById('profileStatus').textContent = getStatusText(currentUser.status || 'online');
            document.getElementById('profileDescription').textContent = currentUser.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è';
            
            // –°—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞
            let accountStatus = '–û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            if (currentUser.isDeveloper) accountStatus = 'üë®‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ Epic';
            else if (currentUser.verified) accountStatus = '‚úÖ –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            
            document.getElementById('profileAccountStatus').textContent = accountStatus;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫
            if (currentUser.isDeveloper) {
                document.getElementById('adminMenuItem').style.display = 'block';
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–¥–∞—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            loadUserGifts();
        }
        
        async function loadUserGifts() {
            try {
                const response = await fetch(`/api/users/${currentUser.id}/gifts`);
                const userGifts = await response.json();
                displayUserGifts(userGifts);
            } catch (error) {
                console.error('Error loading user gifts:', error);
            }
        }
        
        function displayUserGifts(gifts) {
            const container = document.getElementById('userGifts');
            
            if (!gifts || gifts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="padding: 20px; grid-column: 1 / -1;">
                        <div>üéÅ</div>
                        <div style="font-size: 12px;">–ù–µ—Ç –ø–æ–¥–∞—Ä–∫–æ–≤</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = gifts.map(gift => `
                <div class="gift-item">
                    <div class="gift-preview">
                        ${gift.type === 'image' ? 
                            `<img src="${gift.previewUrl}" alt="${gift.name}">` :
                            gift.type === 'animation' ?
                            `<video autoplay loop muted><source src="${gift.previewUrl}" type="video/mp4"></video>` :
                            'üéÅ'
                        }
                    </div>
                    <div class="gift-name">${gift.name}</div>
                    <div class="gift-price">–û—Ç ${gift.senderName}</div>
                </div>
            `).join('');
        }
        
        function displayGiftsShop() {
            const container = document.getElementById('giftsList');
            
            if (!gifts || gifts.length === 0) {
                container.innerHTML = '<div class="empty-state">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤</div>';
                return;
            }
            
            container.innerHTML = `
                <div class="profile-info">
                    <div class="profile-label">üéÅ –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏</div>
                    <div class="gifts-grid">
                        ${gifts.map(gift => `
                            <div class="gift-item" onclick="selectGift('${gift.id}')">
                                <div class="gift-preview">
                                    ${gift.type === 'image' ? 
                                        `<img src="${gift.previewUrl}" alt="${gift.name}">` :
                                        gift.type === 'animation' ?
                                        `<video autoplay loop muted><source src="${gift.previewUrl}" type="video/mp4"></video>` :
                                        'üéÅ'
                                    }
                                </div>
                                <div class="gift-name">${gift.name}</div>
                                <div class="gift-price">${gift.price} üíé</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function selectGift(giftId) {
            const gift = gifts.find(g => g.id === giftId);
            if (!gift) return;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥–∞—Ä–∫–∞
            showGiftRecipientDialog(gift);
        }
        
        function showGiftRecipientDialog(gift) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            // –î–ª—è –¥–µ–º–æ –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥–∞—Ä–æ–∫ –ø–µ—Ä–≤–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            if (allUsers.length > 0) {
                sendGift(gift, allUsers[0]);
            }
        }
        
        async function sendGift(gift, recipient) {
            try {
                const response = await fetch('/api/send-gift', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        giftId: gift.id,
                        senderId: currentUser.id,
                        recipientId: recipient.id
                    })
                });
                
                if (response.ok) {
                    alert(`–ü–æ–¥–∞—Ä–æ–∫ "${gift.name}" –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${recipient.displayName}!`);
                    closeShop();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–æ–¥–∞—Ä–∫–∞');
                }
            } catch (error) {
                console.error('Error sending gift:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–æ–¥–∞—Ä–∫–∞');
            }
        }
        
        function loadAdminUsers() {
            const container = document.getElementById('adminUsersList');
            
            container.innerHTML = allUsers.map(user => `
                <div class="admin-user-item">
                    <div class="admin-user-header">
                        <div class="admin-user-avatar">
                            ${user.avatar ? 
                                `<img src="${user.avatar}" alt="${user.displayName}">` :
                                user.displayName.charAt(0).toUpperCase()
                            }
                        </div>
                        <div class="admin-user-info">
                            <div class="admin-user-name">
                                ${user.displayName}
                                ${user.verified ? getVerifiedBadge() : ''}
                                ${user.isDeveloper ? getDeveloperBadge() : ''}
                            </div>
                            <div class="admin-user-email">@${user.username}</div>
                        </div>
                    </div>
                    <div class="admin-actions">
                        <button class="admin-btn ${user.verified ? 'active' : ''}" onclick="toggleUserVerified('${user.id}')">
                            ‚úÖ
                        </button>
                        <button class="admin-btn ${user.isDeveloper ? 'active' : ''}" onclick="toggleUserDeveloper('${user.id}')">
                            üë®‚Äçüíª
                        </button>
                        <button class="admin-btn delete" onclick="deleteUser('${user.id}')">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function toggleUserVerified(userId) {
            socket.emit('toggle_user_verified', {
                userId: userId,
                adminId: currentUser.id
            });
        }
        
        function toggleUserDeveloper(userId) {
            socket.emit('toggle_user_developer', {
                userId: userId,
                adminId: currentUser.id
            });
        }
        
        function deleteUser(userId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
                socket.emit('delete_user', {
                    userId: userId,
                    adminId: currentUser.id
                });
            }
        }
        
        function searchUsers() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            
            if (!query) {
                displayChatsList();
                return;
            }
            
            const filteredUsers = allUsers.filter(user => 
                user.displayName.toLowerCase().includes(query) || 
                user.username.toLowerCase().includes(query)
            );
            
            const container = document.getElementById('chatsSection');
            
            if (filteredUsers.length === 0) {
                container.innerHTML = '<div class="empty-state">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }
            
            container.innerHTML = filteredUsers.map(user => `
                <div class="chat-item" onclick="openChat('${user.id}')">
                    <div class="chat-avatar">
                        ${user.avatar ? 
                            `<img src="${user.avatar}" alt="${user.displayName}">` :
                            user.displayName.charAt(0).toUpperCase()
                        }
                    </div>
                    <div class="chat-info">
                        <div class="chat-name">
                            ${user.displayName}
                            ${user.verified ? getVerifiedBadge() : ''}
                            ${user.isDeveloper ? getDeveloperBadge() : ''}
                        </div>
                        <div class="chat-last-message">@${user.username} ‚Ä¢ ${getStatusText(user.status)}</div>
                    </div>
                </div>
            `).join('');
        }
        
        function searchAdminUsers() {
            // –ü–æ–∏—Å–∫ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
            const query = document.getElementById('adminSearch').value.toLowerCase();
            loadAdminUsers(); // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
        }
        
        function updateUserStatus(userId, status) {
            const user = allUsers.find(u => u.id === userId);
            if (user) {
                user.status = status;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–∫–µ —á–∞—Ç–æ–≤
                const chatItem = document.querySelector(`[onclick="openChat('${userId}')"]`);
                if (chatItem) {
                    const statusElement = chatItem.querySelector('.chat-last-message');
                    if (statusElement) {
                        const username = user.username;
                        statusElement.textContent = `@${username} ‚Ä¢ ${getStatusText(status)}`;
                    }
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ —á–∞—Ç–∞ –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç
                if (currentChat && currentChat.id === userId) {
                    document.getElementById('chatUserStatus').textContent = getStatusText(status);
                }
            }
        }
        
        function mobileLogout() {
            localStorage.removeItem('user');
            window.location.href = '/login.html';
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–∞–π–ø–æ–≤ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        let touchStartX = 0;
        let touchEndX = 0;
        
        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        });
        
        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });
        
        function handleSwipe() {
            const swipeThreshold = 50;
            const swipeDistance = touchEndX - touchStartX;
            
            if (Math.abs(swipeDistance) < swipeThreshold) return;
            
            // –°–≤–∞–π–ø –≤–ª–µ–≤–æ (next)
            if (swipeDistance < -swipeThreshold) {
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é –º–µ–∂–¥—É —Ç–∞–±–∞–º–∏
            }
            
            // –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ (back)
            if (swipeDistance > swipeThreshold) {
                // –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞–∑–∞–¥
                if (!document.getElementById('mainView').classList.contains('hidden')) {
                    // –ú—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ - –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
                } else if (!document.getElementById('chatView').classList.contains('hidden')) {
                    closeChat();
                } else if (!document.getElementById('profileView').classList.contains('hidden')) {
                    closeProfile();
                } else if (!document.getElementById('settingsView').classList.contains('hidden')) {
                    closeSettings();
                } else if (!document.getElementById('adminView').classList.contains('hidden')) {
                    closeAdmin();
                } else if (!document.getElementById('shopView').classList.contains('hidden')) {
                    closeShop();
                }
            }
        }
    </script>
</body>
</html>
[file content end]
