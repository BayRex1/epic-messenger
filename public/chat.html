<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сообщения - Epic Messenger</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="theme-dark">
    <!-- Сайдбар -->
    <div class="sidebar" id="sidebar">
        <div class="profile-section" id="profileSection">
            <div class="profile-header">
                <div class="avatar" id="userAvatar">U</div>
                <div class="profile-info">
                    <h3 id="userName">
                        Пользователь
                        <span class="verified-badge" id="verifiedBadge" style="display: none;">
                            <img src="/assets/verified-developer/verified.png" alt="Verified">
                        </span>
                        <span class="developer-badge" id="developerBadge" style="display: none;">
                            <img src="/assets/verified-developer/developer.png" alt="Developer">
                        </span>
                    </h3>
                    <div class="username" id="userUsername">@username</div>
                </div>
            </div>
        </div>

        <div class="compact-menu">
            <a href="/chat" class="menu-item active">
                <div class="menu-icon">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2Z"/>
                    </svg>
                </div>
                <div class="menu-text">Сообщения</div>
            </a>
            
            <a href="/post" class="menu-item">
                <div class="menu-icon">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M18,16.08C17.24,16.08 16.56,16.38 16.04,16.85L8.91,12.7C8.96,12.47 9,12.24 9,12C9,11.76 8.96,11.53 8.91,11.3L15.96,7.19C16.5,7.69 17.21,8 18,8A3,3 0 0,0 21,5A3,3 0 0,0 18,2A3,3 0 0,0 15,5C15,5.24 15.04,5.47 15.09,5.7L8.04,9.81C7.5,9.31 6.79,9 6,9A3,3 0 0,0 3,12A3,3 0 0,0 6,15C6.79,15 7.5,14.69 8.04,14.19L15.16,18.34C15.11,18.55 15.08,18.77 15.08,19C15.08,20.61 16.39,21.91 18,21.91C19.61,21.91 20.92,20.61 20.92,19A2.92,2.92 0 0,0 18,16.08Z"/>
                    </svg>
                </div>
                <div class="menu-text">Посты</div>
            </a>
            
            <a href="/gifts" class="menu-item">
                <div class="menu-icon">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M22,12V20A2,2 0 0,1 20,22H4A2,2 0 0,1 2,20V12A1,1 0 0,1 1,11V8A2,2 0 0,1 3,6H6.17C6.06,5.69 6,5.35 6,5A3,3 0 0,1 9,2C10,2 10.88,2.5 11.43,3.24V3.23L12,4L12.57,3.23V3.24C13.12,2.5 14,2 15,2A3,3 0 0,1 18,5C18,5.35 17.94,5.69 17.83,6H21A2,2 0 0,1 23,8V11A1,1 0 0,1 22,12M4,20H11V12H4V20M20,20V12H13V20H20M9,4A1,1 0 0,0 8,5A1,1 0 0,0 9,6A1,1 0 0,0 10,5A1,1 0 0,0 9,4M15,4A1,1 0 0,0 14,5A1,1 0 0,0 15,6A1,1 0 0,0 16,5A1,1 0 0,0 15,4M3,8V10H11V8H3M13,8V10H21V8H13Z"/>
                    </svg>
                </div>
                <div class="menu-text">Подарки</div>
            </a>
            
            <a href="/ecoins" class="menu-item">
                <div class="menu-icon">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,17H13A2,2 0 0,0 15,15V13.5A1.5,1.5 0 0,0 13.5,12A1.5,1.5 0 0,0 15,10.5V9A2,2 0 0,0 13,7H11A2,2 0 0,0 9,9V9.5H11V9H13V10.5H11V11H13A2,2 0 0,0 15,13V13.5A1.5,1.5 0 0,0 13.5,15A1.5,1.5 0 0,0 15,16.5V17A2,2 0 0,0 13,19H11A2,2 0 0,0 9,17V16.5H11V17Z"/>
                    </svg>
                </div>
                <div class="menu-text">E-COIN</div>
            </a>
            
            <a href="/music" class="menu-item">
                <div class="menu-icon">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M12,3V12.26C11.5,12.09 11,12 10.5,12C8,12 6,14 6,16.5C6,19 8,21 10.5,21C13,21 15,19 15,16.5V6H19V3H12Z"/>
                    </svg>
                </div>
                <div class="menu-text">Музыка</div>
            </a>

            <a href="/search" class="menu-item">
                <div class="menu-icon">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
                    </svg>
                </div>
                <div class="menu-text">Поиск</div>
            </a>
            
            <div class="menu-divider"></div>
            
            <a href="/profile" class="menu-item">
                <div class="menu-icon">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"/>
                    </svg>
                </div>
                <div class="menu-text">Мой профиль</div>
            </a>
            
            <a href="/settings" class="menu-item">
                <div class="menu-icon">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
                    </svg>
                </div>
                <div class="menu-text">Настройки</div>
            </a>
            
            <a href="/admin" class="menu-item" id="adminPanelBtn" style="display: none;">
                <div class="menu-icon">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10V11.5C15.4,11.5 16,12.1 16,12.7V16.5C16,17.1 15.4,17.7 14.8,17.7H9.2C8.6,17.7 8,17.1 8,16.5V12.6C8,12 8.6,11.4 9.2,11.4V10C9.2,8.6 10.6,7 12,7M12,8.2C11.2,8.2 10.5,8.7 10.5,9.5V11.5H13.5V9.5C13.5,8.7 12.8,8.2 12,8.2Z"/>
                    </svg>
                </div>
                <div class="menu-text">Админ панель</div>
            </a>
            
            <div class="menu-divider"></div>
            
            <button class="menu-item" id="logoutBtn">
                <div class="menu-icon">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M16,17V14H9V10H16V7L21,12L16,17M14,2A2,2 0 0,1 16,4V6H14V4H5V20H14V18H16V20A2,2 0 0,1 14,22H5A2,2 0 0,1 3,20V4A2,2 0 0,1 5,2H14Z"/>
                    </svg>
                </div>
                <div class="menu-text">Выйти</div>
            </button>
        </div>
    </div>

    <div class="main-content">
        <!-- Чат -->
        <div class="content-area active" id="chat-section">
            <div class="chat-container">
                <div class="chats-sidebar">
                    <div class="search-box">
                        <input type="text" placeholder="Поиск чатов..." id="chatSearch">
                    </div>

                    <!-- Кнопки создания чата и группы -->
                    <div class="chat-actions-header">
                        <button class="chat-action-btn" id="newChatBtn" title="Новый чат">
                            <svg viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" />
                            </svg>
                            Новый чат
                        </button>
                        <button class="chat-action-btn" id="createGroupBtn" title="Создать группу">
                            <svg viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M12,2C6.48,2 2,6.48 2,12C2,17.52 6.48,22 12,22C17.52,22 22,17.52 22,12C22,6.48 17.52,2 12,2ZM17,13H13V17H11V13H7V11H11V7H13V11H17V13Z" />
                            </svg>
                            Создать группу
                        </button>
                    </div>

                    <!-- Поиск пользователей для нового чата -->
                    <div class="user-search-container" id="userSearchContainer" style="display: none;">
                        <div class="search-input-wrapper">
                            <input type="text" placeholder="Поиск пользователя по имени или @username..." id="userSearchInput">
                            <button class="close-search" id="closeUserSearch">&times;</button>
                        </div>
                        <div class="user-search-results" id="userSearchResults"></div>
                    </div>

                    <!-- Создание группы -->
                    <div class="create-group-container" id="createGroupContainer" style="display: none;">
                        <div class="group-form">
                            <h4>Создать группу</h4>
                            <input type="text" placeholder="Название группы" id="groupNameInput">
                            <input type="text" placeholder="Username группы (опционально)" id="groupUsernameInput">
                            <div class="group-members-selection">
                                <h5>Выберите участников:</h5>
                                <div class="available-users" id="availableUsersList"></div>
                                <div class="selected-members" id="selectedMembersList"></div>
                            </div>
                            <div class="group-form-actions">
                                <button class="btn secondary" id="cancelGroupCreate">Отмена</button>
                                <button class="btn primary" id="confirmGroupCreate">Создать группу</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chats-list" id="chatsList">
                        <div class="system-message">Загрузка чатов...</div>
                    </div>
                </div>
                
                <div class="chat-area">
                    <div class="chat-header">
                        <div class="chat-user-info" id="currentChatInfo">
                            <div class="chat-avatar" id="currentChatAvatar"></div>
                            <div class="chat-info">
                                <h4 id="currentChatName">Выберите чат</h4>
                                <span id="currentChatStatus">Начните общение</span>
                            </div>
                        </div>
                        <div class="chat-actions">
                            <button class="file-upload-btn" id="voiceCallBtn" title="Голосовой вызов">
                                <svg viewBox="0 0 24 24" width="20" height="20">
                                    <path fill="currentColor" d="M6.62,10.79C8.06,13.62 10.38,15.94 13.21,17.38L15.41,15.18C15.69,14.9 16.08,14.82 16.43,14.93C17.55,15.3 18.75,15.5 20,15.5A1,1 0 0,1 21,16.5V20A1,1 0 0,1 20,21A17,17 0 0,1 3,4A1,1 0 0,1 4,3H7.5A1,1 0 0,1 8.5,4C8.5,5.25 8.7,6.45 9.07,7.57C9.18,7.92 9.1,8.31 8.82,8.59L6.62,10.79Z"/>
                                </svg>
                            </button>
                            <button class="file-upload-btn" id="videoCallBtn" title="Видео вызов">
                                <svg viewBox="0 0 24 24" width="20" height="20">
                                    <path fill="currentColor" d="M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="chat-messages" id="chatMessages">
                        <div class="system-message">
                            Выберите чат для начала общения
                        </div>
                    </div>
                    
                    <div class="message-input-container">
                        <div class="emoji-picker" id="emojiPicker"></div>
                        <div class="message-input-wrapper">
                            <div class="file-upload-buttons">
                                <button class="file-upload-btn" id="emojiBtn" title="Эмодзи">
                                    <svg viewBox="0 0 24 24" width="20" height="20">
                                        <path fill="currentColor" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M7,9.5A1.5,1.5 0 0,1 8.5,8A1.5,1.5 0 0,1 10,9.5A1.5,1.5 0 0,1 8.5,11A1.5,1.5 0 0,1 7,9.5M16,16H8V14H16V16M15.5,11A1.5,1.5 0 0,1 14,9.5A1.5,1.5 0 0,1 15.5,8A1.5,1.5 0 0,1 17,9.5A1.5,1.5 0 0,1 15.5,11Z"/>
                                    </svg>
                                </button>
                                <button class="file-upload-btn" id="uploadImageBtn" title="Фото">
                                    <svg viewBox="0 0 24 24" width="20" height="20">
                                        <path fill="currentColor" d="M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z"/>
                                    </svg>
                                </button>
                                <button class="file-upload-btn" id="uploadVideoBtn" title="Видео">
                                    <svg viewBox="0 0 24 24" width="20" height="20">
                                        <path fill="currentColor" d="M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z"/>
                                    </svg>
                                </button>
                                <button class="file-upload-btn" id="uploadAudioBtn" title="Аудио">
                                    <svg viewBox="0 0 24 24" width="20" height="20">
                                        <path fill="currentColor" d="M12,3V12.26C11.5,12.09 11,12 10.5,12C8,12 6,14 6,16.5C6,19 8,21 10.5,21C13,21 15,19 15,16.5V6H19V3H12Z"/>
                                    </svg>
                                </button>
                            </div>
                            <input type="text" placeholder="Введите сообщение..." id="messageInput">
                        </div>
                        <button class="send-btn" id="sendMessageBtn">Отправить</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Уведомления -->
    <div id="notificationsContainer"></div>

    <!-- Модальные окна -->
    <div id="uploadFileModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="uploadFileTitle">Загрузить файл</h3>
                <span class="close" id="closeUploadFile">&times;</span>
            </div>
            <div class="modal-body">
                <div class="file-upload-area" id="fileUploadArea">
                    <div>Перетащите сюда файл или нажмите для выбора</div>
                    <input type="file" id="fileInput" style="display: none;">
                </div>
                <div class="file-preview" id="filePreview"></div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelUploadFile">Отмена</button>
                <button class="modal-btn primary" id="sendFile">Отправить файл</button>
            </div>
        </div>
    </div>

    <div id="userProfileModal" class="modal-overlay" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="userProfileTitle">Профиль пользователя</h3>
                <span class="close" id="closeUserProfile">&times;</span>
            </div>
            <div class="modal-body" id="userProfileContent">
                <!-- Контент будет загружен динамически -->
            </div>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script src="js/chat.js"></script>
</body>
</html>
