[file name]: chat.js
[file content begin]
// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —á–∞—Ç–æ–º

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
let currentChat = null;
let currentUser = null;
let socket = null;
let currentFileData = null;
let currentFileType = null;
let emojiList = []; // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –¥–ª—è —ç–º–æ–¥–∑–∏

async function loadChats() {
    try {
        const token = localStorage.getItem('authToken');
        if (!token) {
            console.error('–¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω');
            showNotification('–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', 'error');
            return;
        }

        const response = await fetch('/api/chats', {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log('–ü–æ–ª—É—á–µ–Ω—ã —á–∞—Ç—ã:', data);
        
        if (data.success) {
            renderChats(data.chats);
        } else {
            console.error('–û—à–∏–±–∫–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data.message);
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤: ' + (data.message || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤:', error);
        showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤', 'error');
    }
}

function renderChats(chats) {
    const chatsList = document.getElementById('chatsList');
    if (!chatsList) {
        console.error('–≠–ª–µ–º–µ–Ω—Ç chatsList –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    chatsList.innerHTML = '';
    
    if (!chats || chats.length === 0) {
        chatsList.innerHTML = '<div class="system-message">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —á–∞—Ç–æ–≤</div>';
        return;
    }
    
    chats.forEach(chat => {
        const chatElement = document.createElement('div');
        chatElement.className = 'chat-item';
        chatElement.setAttribute('data-user-id', chat.id);
        
        let lastMessageText = '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π';
        if (chat.lastMessage) {
            if (chat.lastMessage.type === 'gift') {
                lastMessageText = 'üéÅ –ü–æ–¥–∞—Ä–æ–∫';
            } else if (chat.lastMessage.file) {
                lastMessageText = 'üìé –§–∞–π–ª';
            } else {
                lastMessageText = chat.lastMessage.text || '–°–æ–æ–±—â–µ–Ω–∏–µ';
            }
        }
        
        // SVG –¥–ª—è Epic Verified
        const verifiedBadge = chat.verified ? 
            '<span class="verified-badge"><svg width="16" height="16" viewBox="0 0 256 256"><path d="M128 10 L143 33 L170 25 L180 50 L207 45 L210 70 L235 80 L225 105 L245 125 L225 145 L235 170 L210 180 L207 205 L180 200 L170 225 L143 217 L128 240 L113 217 L86 225 L76 200 L49 205 L46 180 L21 170 L31 145 L11 125 L31 105 L21 80 L46 70 L49 45 L76 50 L86 25 L113 33 Z" fill="url(#goldGradient)"/><path d="M95 125 L120 150 L165 100" fill="none" stroke="#fff7c0" stroke-width="14" stroke-linecap="round" stroke-linejoin="round"/><defs><radialGradient id="goldGradient" cx="50%" cy="40%" r="60%"><stop offset="0%" stop-color="#FFD700"/><stop offset="40%" stop-color="#FFC300"/><stop offset="100%" stop-color="#B8860B"/></radialGradient></defs></svg></span>' : '';

        // SVG –¥–ª—è Epic Developer
        const developerBadge = chat.isDeveloper ? 
            '<span class="developer-badge"><svg width="16" height="16" viewBox="0 0 48 48"><rect width="48" height="48" rx="8" fill="url(#grad)"/><text x="24" y="30" text-anchor="middle" fill="url(#neon)" font-size="26" font-family="Arial, sans-serif" font-weight="bold" style="filter: drop-shadow(0 0 4px #C71585) drop-shadow(0 0 6px #8A2BE2);">E</text><defs><linearGradient id="grad" x1="0" y1="0" x2="48" y2="48" gradientUnits="userSpaceOnUse"><stop stop-color="#8A2BE2"/><stop offset="1" stop-color="#C71585"/></linearGradient><linearGradient id="neon" x1="0" y1="0" x2="0" y2="48" gradientUnits="userSpaceOnUse"><stop stop-color="#FFFFFF"/><stop offset="1" stop-color="#FFD1FF"/></linearGradient></defs></svg></span>' : '';

        const statusClass = chat.status === 'online' ? 'online-status' : 'offline-status';
        const unreadBadge = chat.unreadCount > 0 ? `<div class="unread-badge">${chat.unreadCount}</div>` : '';

        chatElement.innerHTML = `
            <div class="chat-avatar">
                ${chat.avatar ? 
                    `<img src="${chat.avatar}" alt="${chat.displayName}" style="width: 100%; height: 100%; object-fit: cover;">` : 
                    chat.displayName ? chat.displayName.charAt(0).toUpperCase() : 'U'
                }
            </div>
            <div class="chat-info">
                <h4>
                    ${chat.displayName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}
                    ${verifiedBadge}
                    ${developerBadge}
                    <span class="${statusClass}"></span>
                </h4>
                <div class="chat-last-message">${lastMessageText}</div>
            </div>
            ${unreadBadge}
        `;
        
        chatElement.addEventListener('click', () => selectChat(chat));
        chatsList.appendChild(chatElement);
    });
}

function selectChat(chat) {
    currentChat = chat;
    
    // –û—Ç–º–µ—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
    markAsRead(chat.id);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —á–∞—Ç–µ
    const currentChatName = document.getElementById('currentChatName');
    const currentChatStatus = document.getElementById('currentChatStatus');
    const currentChatAvatar = document.getElementById('currentChatAvatar');
    
    if (currentChatName) currentChatName.textContent = chat.displayName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
    if (currentChatStatus) {
        currentChatStatus.textContent = chat.status === 'online' ? '–í —Å–µ—Ç–∏' : `–ë—ã–ª(–∞) –≤ —Å–µ—Ç–∏ ${new Date(chat.lastSeen).toLocaleString()}`;
    }
    
    if (currentChatAvatar) {
        if (chat.avatar) {
            currentChatAvatar.innerHTML = `<img src="${chat.avatar}" alt="${chat.displayName}" style="width: 100%; height: 100%; object-fit: cover;">`;
        } else {
            currentChatAvatar.textContent = chat.displayName ? chat.displayName.charAt(0).toUpperCase() : 'U';
        }
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
    loadChatMessages(chat.id);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ (—É–±–∏—Ä–∞–µ–º badge)
    loadChats();
}

async function markAsRead(fromUserId) {
    try {
        const token = localStorage.getItem('authToken');
        await fetch('/api/messages/mark-read', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                fromUserId: fromUserId
            })
        });

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º WebSocket —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–æ—á—Ç–µ–Ω–∏–∏
        if (socket && socket.readyState === WebSocket.OPEN) {
            socket.send(JSON.stringify({
                type: 'mark_read',
                fromUserId: fromUserId
            }));
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö:', error);
    }
}

async function loadChatMessages(userId) {
    try {
        const token = localStorage.getItem('authToken');
        const response = await fetch(`/api/messages?userId=${currentUser?.id || ''}&toUserId=${userId}`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.success) {
            renderChatMessages(data.messages);
        } else {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:', data.message);
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:', error);
    }
}

function renderChatMessages(messages) {
    const chatMessages = document.getElementById('chatMessages');
    if (!chatMessages) {
        console.error('–≠–ª–µ–º–µ–Ω—Ç chatMessages –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    chatMessages.innerHTML = '';
    
    if (!messages || messages.length === 0) {
        chatMessages.innerHTML = '<div class="system-message">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π. –ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ!</div>';
        return;
    }
    
    messages.forEach(message => {
        renderNewMessage(message);
    });
    
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function renderNewMessage(message) {
    const chatMessages = document.getElementById('chatMessages');
    if (!chatMessages) return;

    const messageElement = document.createElement('div');
    const isOutgoing = message.senderId === currentUser?.id;
    messageElement.className = `message ${isOutgoing ? 'outgoing' : 'incoming'}`;
    messageElement.setAttribute('data-message-id', message.id);
    
    let readStatus = '';
    if (isOutgoing) {
        readStatus = `<div class="read-status ${message.read ? 'read' : 'unread'}">
            ${message.read ? '‚úì‚úì' : '‚úì'}
        </div>`;
    }
    
    if (message.type === 'gift') {
        messageElement.innerHTML = `
            <div class="message-gift">
                <div class="gift-preview">
                    ${message.giftImage ? 
                        `<img src="${message.giftImage}" alt="${message.giftName}" style="width: 40px; height: 40px;">` : 
                        message.giftPreview || 'üéÅ'
                    }
                </div>
                <div class="gift-info">
                    <div class="gift-name">${message.giftName || '–ü–æ–¥–∞—Ä–æ–∫'}</div>
                    <div class="gift-price">–¶–µ–Ω–∞: ${message.giftPrice || 0} E-COIN</div>
                    <div class="message-time">${new Date(message.timestamp).toLocaleString()}</div>
                </div>
            </div>
            ${readStatus}
        `;
    } else if (message.file) {
        let fileContent = '';
        if (message.fileType === 'image') {
            fileContent = `<img src="${message.file}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" onclick="openImageModal('${message.file}')">`;
        } else if (message.fileType === 'video') {
            fileContent = `<video controls><source src="${message.file}" type="video/mp4"></video>`;
        } else if (message.fileType === 'audio') {
            fileContent = `
                <div class="message-audio">
                    <div class="audio-controls">
                        <button class="audio-play-btn">‚ñ∂</button>
                        <div class="audio-waveform"></div>
                    </div>
                    <div class="voice-duration">0:00</div>
                </div>
            `;
        } else {
            fileContent = `<div>–§–∞–π–ª: ${message.fileName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–∞–π–ª'}</div>`;
        }
        
        messageElement.innerHTML = `
            <div class="message-file">
                <div class="message-text">${message.text || ''}</div>
                <div class="message-file-content">
                    ${fileContent}
                </div>
                <div class="message-time">${new Date(message.timestamp).toLocaleString()}</div>
            </div>
            ${readStatus}
        `;
    } else {
        // –ó–∞–º–µ–Ω—è–µ–º —ç–º–æ–¥–∑–∏ –∫–æ–¥—ã –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É–ø–æ–º–∏–Ω–∞–Ω–∏—è
        let messageText = message.text || '';
        messageText = processMentions ? processMentions(messageText) : messageText;
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —ç–º–æ–¥–∑–∏
        if (emojiList && emojiList.length > 0) {
            emojiList.forEach(emoji => {
                const emojiCode = `:${emoji.name}:`;
                if (messageText.includes(emojiCode)) {
                    messageText = messageText.replace(new RegExp(emojiCode, 'g'), 
                        `<img src="${emoji.url}" alt="${emoji.name}" style="width: 20px; height: 20px; vertical-align: middle;">`);
                }
            });
        }
        
        messageElement.innerHTML = `
            <div class="message-text">${messageText}</div>
            <div class="message-time">${new Date(message.timestamp).toLocaleString()}</div>
            ${readStatus}
        `;
    }
    
    chatMessages.appendChild(messageElement);
    
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

async function sendMessage() {
    const messageInput = document.getElementById('messageInput');
    const text = messageInput?.value.trim();
    
    if ((!text || text === '') && !currentFileData) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ', 'warning');
        return;
    }
    
    if (!currentChat) {
        showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è', 'warning');
        return;
    }

    try {
        const token = localStorage.getItem('authToken');
        if (!token) {
            showNotification('–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', 'error');
            return;
        }
        
        let requestData = {
            toUserId: currentChat.id,
            text: text || '',
            type: 'text'
        };

        // –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–π–ª, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ –∑–∞–ø—Ä–æ—Å
        if (currentFileData) {
            const fileType = currentFileType || 'file';
            requestData.file = currentFileData;
            requestData.fileName = document.getElementById('fileInput')?.files[0]?.name || 'file';
            requestData.fileType = fileType;
            requestData.type = fileType;
        }

        const response = await fetch('/api/messages/send', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(requestData)
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.success) {
            if (messageInput) messageInput.value = '';
            currentFileData = null;
            currentFileType = null;
            const filePreview = document.getElementById('filePreview');
            if (filePreview) filePreview.innerHTML = '';
            const uploadFileModal = document.getElementById('uploadFileModal');
            if (uploadFileModal) uploadFileModal.style.display = 'none';
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ WebSocket
            if (socket && socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify({
                    type: 'new_message',
                    message: data.message
                }));
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            renderNewMessage(data.message);
            loadChats();
        } else {
            showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: ' + data.message, 'error');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
        showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è', 'error');
    }
}

function showUploadFileModal(fileType) {
    currentFileType = fileType;
    const modal = document.getElementById('uploadFileModal');
    const title = document.getElementById('uploadFileTitle');
    
    if (!modal || !title) {
        console.error('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
        return;
    }
    
    let typeText = '';
    switch(fileType) {
        case 'image':
            typeText = '–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ';
            document.getElementById('fileInput').accept = 'image/*';
            break;
        case 'video':
            typeText = '–≤–∏–¥–µ–æ';
            document.getElementById('fileInput').accept = 'video/*';
            break;
        case 'audio':
            typeText = '–∞—É–¥–∏–æ';
            document.getElementById('fileInput').accept = 'audio/*';
            break;
    }
    
    title.textContent = `–ó–∞–≥—Ä—É–∑–∏—Ç—å ${typeText}`;
    const fileUploadArea = document.getElementById('fileUploadArea');
    if (fileUploadArea) {
        fileUploadArea.querySelector('div').textContent = 
            `–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ ${typeText} –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞`;
    }
    
    modal.style.display = 'flex';
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showNotification(message, type = 'info') {
    console.log(`Notification [${type}]: ${message}`);
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    // –ù–∞–ø—Ä–∏–º–µ—Ä, –∏—Å–ø–æ–ª—å–∑—É—è Toast –±–∏–±–ª–∏–æ—Ç–µ–∫—É –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π (–∑–∞–≥–ª—É—à–∫–∞)
function processMentions(text) {
    return text; // –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞
function initializeChat() {
    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞...');
    
    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    try {
        const userData = localStorage.getItem('userData');
        if (userData) {
            currentUser = JSON.parse(userData);
            console.log('–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', currentUser);
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
    }

    const sendMessageBtn = document.getElementById('sendMessageBtn');
    const messageInput = document.getElementById('messageInput');
    const uploadImageBtn = document.getElementById('uploadImageBtn');
    const uploadVideoBtn = document.getElementById('uploadVideoBtn');
    const uploadAudioBtn = document.getElementById('uploadAudioBtn');
    const sendFileBtn = document.getElementById('sendFile');
    const closeUploadFile = document.getElementById('closeUploadFile');
    const cancelUploadFile = document.getElementById('cancelUploadFile');

    if (sendMessageBtn) {
        sendMessageBtn.addEventListener('click', sendMessage);
    } else {
        console.warn('–ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
    }
    
    if (messageInput) {
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendMessage();
        });
    } else {
        console.warn('–ü–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
    }

    // –ö–Ω–æ–ø–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
    if (uploadImageBtn) {
        uploadImageBtn.addEventListener('click', function() {
            showUploadFileModal('image');
        });
    }

    if (uploadVideoBtn) {
        uploadVideoBtn.addEventListener('click', function() {
            showUploadFileModal('video');
        });
    }

    if (uploadAudioBtn) {
        uploadAudioBtn.addEventListener('click', function() {
            showUploadFileModal('audio');
        });
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞
    if (sendFileBtn) {
        sendFileBtn.addEventListener('click', function() {
            if (currentFileData) {
                sendMessage();
            } else {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏', 'warning');
            }
        });
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
    if (closeUploadFile) {
        closeUploadFile.addEventListener('click', function() {
            const uploadFileModal = document.getElementById('uploadFileModal');
            if (uploadFileModal) uploadFileModal.style.display = 'none';
            currentFileData = null;
            currentFileType = null;
        });
    }

    if (cancelUploadFile) {
        cancelUploadFile.addEventListener('click', function() {
            const uploadFileModal = document.getElementById('uploadFileModal');
            if (uploadFileModal) uploadFileModal.style.display = 'none';
            currentFileData = null;
            currentFileType = null;
        });
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —á–∞—Ç—ã –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤...');
    loadChats();
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞...');
    initializeChat();
});
[file content end]
