const express = require('express');
const http = require('http');
const socketIo = require('socket.io');
const path = require('path');
const sqlite3 = require('sqlite3').verbose();
const bcrypt = require('bcryptjs');
const cors = require('cors');

const app = express();
const server = http.createServer(app);

const io = socketIo(server, {
  cors: {
    origin: "*",
    methods: ["GET", "POST"]
  }
});

app.use(cors());
app.use(express.json({ limit: '50mb' }));
app.use(express.urlencoded({ extended: true, limit: '50mb' }));
app.use(express.static(__dirname));

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
const db = new sqlite3.Database('./database.db', (err) => {
  if (err) {
    console.error('Error opening database:', err);
  } else {
    console.log('‚úÖ Connected to SQLite database');
    initDatabase();
  }
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü
function initDatabase() {
  // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
  db.run(`CREATE TABLE IF NOT EXISTS users (
    id TEXT PRIMARY KEY,
    email TEXT UNIQUE NOT NULL,
    username TEXT UNIQUE NOT NULL,
    password TEXT NOT NULL,
    status TEXT DEFAULT 'online',
    verified INTEGER DEFAULT 0,
    is_developer INTEGER DEFAULT 0,
    avatar TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
  )`);

  // –°–æ–æ–±—â–µ–Ω–∏—è
  db.run(`CREATE TABLE IF NOT EXISTS messages (
    id TEXT PRIMARY KEY,
    user_id TEXT NOT NULL,
    username TEXT NOT NULL,
    to_user_id TEXT NOT NULL,
    text TEXT NOT NULL,
    type TEXT DEFAULT 'text',
    file_name TEXT,
    file_data TEXT,
    file_type TEXT,
    file_size INTEGER,
    verified INTEGER DEFAULT 0,
    is_developer INTEGER DEFAULT 0,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
  )`);

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  db.run(`CREATE TABLE IF NOT EXISTS user_settings (
    user_id TEXT PRIMARY KEY,
    theme TEXT DEFAULT 'dark',
    notifications INTEGER DEFAULT 1,
    FOREIGN KEY (user_id) REFERENCES users (id)
  )`);

  // –°–æ–∑–¥–∞–µ–º –∞–¥–º–∏–Ω–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
  db.get("SELECT COUNT(*) as count FROM users", (err, row) => {
    if (row.count === 0) {
      const hashedPassword = bcrypt.hashSync('admin123', 10);
      db.run(`INSERT INTO users (id, email, username, password, verified, is_developer) 
              VALUES (?, ?, ?, ?, ?, ?)`, 
        ['admin', 'admin@epic.com', 'Admin', hashedPassword, 1, 1]);
      console.log('üëë Created admin user: admin@epic.com / admin123');
    }
  });
}

// API routes

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
app.post('/api/register', (req, res) => {
  const { email, username, password } = req.body;
  
  if (!email || !username || !password) {
    return res.json({ success: false, message: '–í—Å–µ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' });
  }
  
  if (password.length < 3) {
    return res.json({ success: false, message: '–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π' });
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  db.get("SELECT * FROM users WHERE email = ? OR username = ?", [email, username], (err, row) => {
    if (err) {
      return res.json({ success: false, message: '–û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö' });
    }
    
    if (row) {
      const message = row.email === email ? 'Email —É–∂–µ –∑–∞–Ω—è—Ç' : '–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –∑–∞–Ω—è—Ç–æ';
      return res.json({ success: false, message });
    }
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const userId = Date.now().toString();
    const hashedPassword = bcrypt.hashSync(password, 10);
    
    db.run(`INSERT INTO users (id, email, username, password) VALUES (?, ?, ?, ?)`,
      [userId, email, username, hashedPassword],
      function(err) {
        if (err) {
          return res.json({ success: false, message: '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏' });
        }
        
        res.json({ 
          success: true, 
          message: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', 
          user: { 
            id: userId, 
            username: username,
            email: email,
            verified: false,
            isDeveloper: false,
            avatar: null,
            status: 'online'
          } 
        });
      }
    );
  });
});

// –í—Ö–æ–¥
app.post('/api/login', (req, res) => {
  const { email, password } = req.body;
  
  db.get("SELECT * FROM users WHERE email = ?", [email], (err, user) => {
    if (err || !user) {
      return res.json({ success: false, message: '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å' });
    }
    
    if (!bcrypt.compareSync(password, user.password)) {
      return res.json({ success: false, message: '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å' });
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
    db.run("UPDATE users SET status = 'online' WHERE id = ?", [user.id]);
    
    res.json({ 
      success: true, 
      message: '–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!', 
      user: { 
        id: user.id, 
        username: user.username, 
        email: user.email,
        verified: !!user.verified,
        isDeveloper: !!user.is_developer,
        status: 'online',
        avatar: user.avatar
      } 
    });
  });
});

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
app.post('/api/update-profile', (req, res) => {
  const { userId, username, status, avatarData } = req.body;
  
  if (!userId) {
    return res.json({ success: false, message: 'ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω' });
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  db.get("SELECT id FROM users WHERE username = ? AND id != ?", [username, userId], (err, row) => {
    if (err) {
      return res.json({ success: false, message: '–û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö' });
    }
    
    if (row) {
      return res.json({ success: false, message: '–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –∑–∞–Ω—è—Ç–æ' });
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
    const updates = [];
    const params = [];
    
    if (username) {
      updates.push("username = ?");
      params.push(username);
    }
    
    if (status) {
      updates.push("status = ?");
      params.push(status);
    }
    
    if (avatarData) {
      updates.push("avatar = ?");
      params.push(avatarData);
    }
    
    params.push(userId);
    
    if (updates.length > 0) {
      db.run(`UPDATE users SET ${updates.join(', ')} WHERE id = ?`, params, function(err) {
        if (err) {
          return res.json({ success: false, message: '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è' });
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        db.get("SELECT * FROM users WHERE id = ?", [userId], (err, user) => {
          if (err || !user) {
            return res.json({ success: false, message: '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö' });
          }
          
          res.json({ 
            success: true, 
            message: '–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω',
            user: {
              id: user.id,
              username: user.username,
              email: user.email,
              verified: !!user.verified,
              isDeveloper: !!user.is_developer,
              status: user.status,
              avatar: user.avatar
            }
          });
          
          // –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
          io.emit('user_updated', {
            userId: user.id,
            username: user.username,
            status: user.status,
            avatar: user.avatar
          });
        });
      });
    } else {
      res.json({ success: false, message: '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è' });
    }
  });
});

// –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
app.get('/api/search-users', (req, res) => {
  const { query, currentUserId } = req.query;
  
  if (!query || !currentUserId) {
    return res.json([]);
  }
  
  const searchTerm = `%${query}%`;
  
  db.all(
    `SELECT id, username, email, verified, is_developer, status, avatar 
     FROM users 
     WHERE id != ? AND (username LIKE ? OR email LIKE ?)
     ORDER BY username`,
    [currentUserId, searchTerm, searchTerm],
    (err, rows) => {
      if (err) {
        console.error('Search error:', err);
        return res.json([]);
      }
      
      const users = rows.map(row => ({
        id: row.id,
        username: row.username,
        email: row.email,
        verified: !!row.verified,
        isDeveloper: !!row.is_developer,
        status: row.status,
        avatar: row.avatar
      }));
      
      res.json(users);
    }
  );
});

// –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
app.get('/api/users', (req, res) => {
  const { currentUserId } = req.query;
  
  db.all(
    `SELECT id, username, email, verified, is_developer, status, avatar, created_at 
     FROM users 
     WHERE id != ? 
     ORDER BY username`,
    [currentUserId],
    (err, rows) => {
      if (err) {
        console.error('Users error:', err);
        return res.json([]);
      }
      
      const users = rows.map(row => ({
        id: row.id,
        username: row.username,
        email: row.email,
        verified: !!row.verified,
        isDeveloper: !!row.is_developer,
        status: row.status,
        avatar: row.avatar,
        createdAt: row.created_at
      }));
      
      res.json(users);
    }
  );
});

// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
app.get('/api/user/:id', (req, res) => {
  db.get(
    `SELECT id, username, email, verified, is_developer, status, avatar, created_at 
     FROM users 
     WHERE id = ?`,
    [req.params.id],
    (err, row) => {
      if (err || !row) {
        return res.json({ success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' });
      }
      
      res.json({
        success: true,
        user: {
          id: row.id,
          username: row.username,
          verified: !!row.verified,
          isDeveloper: !!row.is_developer,
          status: row.status,
          avatar: row.avatar,
          createdAt: row.created_at
        }
      });
    }
  );
});

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
app.post('/api/save-settings', (req, res) => {
  const { userId, theme, notifications } = req.body;
  
  if (!userId) {
    return res.json({ success: false, message: 'ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω' });
  }
  
  db.run(
    `INSERT OR REPLACE INTO user_settings (user_id, theme, notifications) 
     VALUES (?, ?, ?)`,
    [userId, theme, notifications ? 1 : 0],
    (err) => {
      if (err) {
        return res.json({ success: false, message: '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫' });
      }
      
      res.json({ success: true, message: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã' });
    }
  );
});

// –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
app.get('/api/settings/:userId', (req, res) => {
  db.get(
    "SELECT theme, notifications FROM user_settings WHERE user_id = ?",
    [req.params.userId],
    (err, row) => {
      const settings = row ? {
        theme: row.theme || 'dark',
        notifications: !!row.notifications
      } : {
        theme: 'dark',
        notifications: true
      };
      
      res.json({ success: true, settings });
    }
  );
});

// –ê–¥–º–∏–Ω–∫–∞ - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
app.get('/api/admin/users', (req, res) => {
  db.all(
    "SELECT id, username, email, verified, is_developer, status, avatar, created_at FROM users",
    (err, rows) => {
      if (err) {
        return res.json([]);
      }
      
      const users = rows.map(row => ({
        id: row.id,
        username: row.username,
        email: row.email,
        verified: !!row.verified,
        isDeveloper: !!row.is_developer,
        status: row.status,
        avatar: row.avatar,
        createdAt: row.created_at
      }));
      
      res.json(users);
    }
  );
});

// –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
app.post('/api/admin/toggle-verify', (req, res) => {
  const { userId, verified } = req.body;
  
  db.run(
    "UPDATE users SET verified = ? WHERE id = ?",
    [verified ? 1 : 0, userId],
    function(err) {
      if (err) {
        return res.json({ success: false, message: '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è' });
      }
      
      res.json({ 
        success: true, 
        message: `–ê–∫–∫–∞—É–Ω—Ç ${verified ? '–≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω' : '–¥–µ–≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω'}` 
      });
      
      io.emit('user_verified', { userId, verified });
    }
  );
});

// –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
app.post('/api/admin/toggle-developer', (req, res) => {
  const { userId, isDeveloper } = req.body;
  
  db.run(
    "UPDATE users SET is_developer = ? WHERE id = ?",
    [isDeveloper ? 1 : 0, userId],
    function(err) {
      if (err) {
        return res.json({ success: false, message: '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è' });
      }
      
      res.json({ 
        success: true, 
        message: `–†–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ ${isDeveloper ? '–Ω–∞–∑–Ω–∞—á–µ–Ω–∞' : '—Å–Ω—è—Ç–∞'}` 
      });
      
      io.emit('user_developer_updated', { userId, isDeveloper });
    }
  );
});

// –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏ (–ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ - —É–±—Ä–∞–ª–∏ —ç–º–æ–¥–∑–∏)
app.get('/api/emojis', (req, res) => {
  res.json({ success: true, emojis: [] });
});

// WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
const onlineUsers = new Map();

io.on('connection', (socket) => {
  console.log('‚úÖ User connected:', socket.id);

  socket.on('user_join', (userData) => {
    const onlineUser = {
      socketId: socket.id,
      username: userData.username,
      userId: userData.userId,
      status: 'online'
    };
    
    onlineUsers.set(socket.id, onlineUser);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –±–∞–∑–µ
    db.run("UPDATE users SET status = 'online' WHERE id = ?", [userData.userId]);
    
    socket.broadcast.emit('user_online', onlineUser);
    io.emit('online_users', Array.from(onlineUsers.values()));
  });

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞
  socket.on('load_chat_history', (data) => {
    db.all(
      `SELECT * FROM messages 
       WHERE (user_id = ? AND to_user_id = ?) OR (user_id = ? AND to_user_id = ?)
       ORDER BY timestamp ASC`,
      [data.userId, data.targetId, data.targetId, data.userId],
      (err, rows) => {
        if (err) {
          console.error('Chat history error:', err);
          return;
        }
        
        const messages = rows.map(row => ({
          id: row.id,
          userId: row.user_id,
          username: row.username,
          text: row.text,
          toUserId: row.to_user_id,
          timestamp: row.timestamp,
          verified: !!row.verified,
          isDeveloper: !!row.is_developer,
          type: row.type,
          fileData: row.file_data,
          fileName: row.file_name,
          fileType: row.file_type,
          fileSize: row.file_size
        }));
        
        socket.emit('chat_history_loaded', { targetId: data.targetId, messages });
      }
    );
  });

  // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
  socket.on('send_message', (messageData) => {
    const onlineUser = onlineUsers.get(socket.id);
    if (!onlineUser) return;
    
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    db.get("SELECT verified, is_developer FROM users WHERE id = ?", [onlineUser.userId], (err, user) => {
      if (err || !user) return;
      
      const messageId = Date.now().toString();
      const message = {
        id: messageId,
        userId: onlineUser.userId,
        username: onlineUser.username,
        text: messageData.text,
        toUserId: messageData.toUserId,
        timestamp: new Date().toISOString(),
        verified: !!user.verified,
        isDeveloper: !!user.is_developer,
        type: messageData.type || 'text',
        fileData: messageData.fileData || null,
        fileName: messageData.fileName || null,
        fileType: messageData.fileType || null,
        fileSize: messageData.fileSize || 0
      };
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É
      db.run(
        `INSERT INTO messages (id, user_id, username, to_user_id, text, type, file_name, file_data, file_type, file_size, verified, is_developer) 
         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
        [message.id, message.userId, message.username, message.toUserId, message.text, 
         message.type, message.fileName, message.fileData, message.fileType, message.fileSize,
         message.verified ? 1 : 0, message.isDeveloper ? 1 : 0],
        (err) => {
          if (err) {
            console.error('Error saving message:', err);
            return;
          }
          
          console.log('üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –±–∞–∑–µ –æ—Ç', message.username, '–∫', message.toUserId);
          
          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é
          socket.emit('new_message', message);
          
          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—É—á–∞—Ç–µ–ª—é –µ—Å–ª–∏ –æ–Ω–ª–∞–π–Ω
          const recipientEntry = Array.from(onlineUsers.entries())
            .find(([_, u]) => u.userId === messageData.toUserId);
          
          if (recipientEntry) {
            const [recipientSocketId, recipientUser] = recipientEntry;
            io.to(recipientSocketId).emit('new_message', message);
            console.log('üì® –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:', recipientUser.username);
          }
        }
      );
    });
  });

  socket.on('disconnect', () => {
    const onlineUser = onlineUsers.get(socket.id);
    if (onlineUser) {
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –±–∞–∑–µ
      db.run("UPDATE users SET status = 'offline' WHERE id = ?", [onlineUser.userId]);
      
      onlineUsers.delete(socket.id);
      socket.broadcast.emit('user_offline', onlineUser.userId);
      io.emit('online_users', Array.from(onlineUsers.values()));
      
      console.log('üëã User disconnected:', onlineUser.username);
    }
  });
});

// –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
app.get('/', (req, res) => {
  res.sendFile(path.join(__dirname, 'login.html'));
});

app.get('/main.html', (req, res) => {
  res.sendFile(path.join(__dirname, 'main.html'));
});

app.get('/admin.html', (req, res) => {
  res.sendFile(path.join(__dirname, 'admin.html'));
});

// –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
const PORT = process.env.PORT || 3000;

server.listen(PORT, () => {
  console.log('=====================================');
  console.log('üöÄ EPIC MESSENGER SERVER STARTED!');
  console.log('üì° Port:', PORT);
  console.log('üíæ Database: SQLite (Persistent)');
  console.log('üîê Authentication: ENABLED');
  console.log('‚úÖ Verified system: ACTIVE');
  console.log('üë®‚Äçüíª Developer badges: ENABLED');
  console.log('üñºÔ∏è Avatar upload: ENABLED');
  console.log('üìÅ File sharing: ENABLED');
  console.log('üîç User search: ENABLED');
  console.log('üòä Emoji keyboard: DISABLED');
  console.log('üîß Admin panel: /admin.html');
  console.log('üîë Admin: admin@epic.com / admin123');
  console.log('=====================================');
});