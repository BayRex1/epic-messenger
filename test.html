<!DOCTYPE html>
<html>
<head>
    <title>Epic Messenger Test</title>
    <style>
        body { font-family: Arial; margin: 20px; background: #1a1a1a; color: white; }
        #chat { border: 2px solid #ff4444; height: 400px; padding: 10px; margin: 10px 0; overflow-y: auto; background: #2a2a2a; }
        .message { margin: 10px 0; padding: 10px; border-radius: 10px; }
        .my-message { background: #ff4444; margin-left: auto; text-align: right; max-width: 70%; }
        .other-message { background: #444; max-width: 70%; }
        .system { background: #333; color: #ccc; font-style: italic; text-align: center; }
        input, button { padding: 10px; margin: 5px; border: 1px solid #555; border-radius: 5px; }
        input { background: #333; color: white; width: 200px; }
        button { background: #ff4444; color: white; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ðŸ”¥ Epic Messenger Test</h1>
    
    <div id="login">
        <input type="text" id="usernameInput" placeholder="Your username" value="Player">
        <button onclick="joinChat()">Join Chat</button>
    </div>
    
    <div id="chatArea" style="display:none">
        <div id="chat"></div>
        <input type="text" id="messageInput" placeholder="Type your message...">
        <button onclick="sendMessage()">Send</button>
        <button onclick="leaveChat()" style="background: #666;">Leave</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentUsername = '';
        
        function joinChat() {
            currentUsername = document.getElementById('usernameInput').value.trim();
            if (!currentUsername) return alert('Enter username!');
            
            socket.emit('user_join', { username: currentUsername });
            document.getElementById('login').style.display = 'none';
            document.getElementById('chatArea').style.display = 'block';
            addMessage('system', `You joined as ${currentUsername}`, 'system');
            document.getElementById('messageInput').focus();
        }
        
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            if (!text) return;
            
            socket.emit('send_message', { text });
            input.value = '';
        }
        
        function leaveChat() {
            socket.disconnect();
            location.reload();
        }
        
        function addMessage(username, text, type = 'other') {
            const chat = document.getElementById('chat');
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${type}-message`;
            msgDiv.innerHTML = `<strong>${username}:</strong> ${text}`;
            chat.appendChild(msgDiv);
            chat.scrollTop = chat.scrollHeight;
        }
        
        socket.on('new_message', (message) => {
            const isMe = message.username === currentUsername;
            addMessage(message.username, message.text, isMe ? 'my' : 'other');
        });
        
        socket.on('user_online', (user) => {
            if (user.username !== currentUsername) {
                addMessage('system', `${user.username} joined the chat`, 'system');
            }
        });
        
        socket.on('user_offline', (user) => {
            addMessage('system', `${user.username} left the chat`, 'system');
        });
        
        socket.on('message_history', (history) => {
            history.forEach(msg => {
                const isMe = msg.username === currentUsername;
                addMessage(msg.username, msg.text, isMe ? 'my' : 'other');
            });
        });
        
        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    </script>
</body>
</html>